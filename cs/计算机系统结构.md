# 量化设计与分析基础
## 分类： Flynn’s 分类，市场分类
基于指令流和数据流数量的计算机结构分类

串行计算机 SISD

并行计算机: 数据级并行 SIMD

单个数据流进入多个处理单元, 每个处理单元用单个指令流对数据进行独立操作MISD

并行计算机: 线程级或请求级并行 MIMD

Flynn分类模型是抽象和粗略的：

现代的不少并行处理器是SISD、SIMD和MIMD的混合类型。
## 系统结构的原始定义和现在的定义
### 原始定义

由程序员（机器语言）看见的（计算）系统属性，即慨念性结构和功能行为，以区分数据流动和控制逻辑设计的组成及物理实现。

### 现代定义

计算机系统结构（现代定义）：是在满足功能、性能和价格目标的条件下，设计、选择和互连 硬件部件构成计算机。

系统结构覆盖：
- 指令系统设计
- 组成（Organization）:计算机设计方面的高层次

  CPU内部结构、存储器、I/O系统、多处理器、网络

- 硬件: 计算机的具体实现技术

  详细逻辑设计、封装、冷却系统、板级设计，功耗等

<details>

## 实现技术、功耗、成本的趋势，可靠性

## 性能评价指标：响应时间、CPU时间、吞吐量
单位时间内完成的工作总量---吞吐量

## 性能评价方法：基准测试程序，SPEC测试程序集及指标（ SPEC Ratio、 Spec mark ）
</details>

## 量化： Amdahl 定律， CPU 时间计算
采用更快的执行方式后所获得的系统性能提高，与这种执行方式的使用频率或占总执行时间的比例有关。

加速比 = 采用改进措施后计算机的性能 / 没有采用措施时计算机的性能
      = 没有采用改进措施时某任务的执行时间 / 采用改进措施之后某任务的执行时间
Amdahl定律中，加速比与两个因素有关：

改进比例 Fe = 可改进部分的执行时间 / 改进前整个任务的执行时间

改进加速比 Se = 改进前改进部分的执行时间 / 改进后改进部分的执行时间

改进后整个任务的执行时间 T<sub>n</sub> = T<sub>0</sub>(1 - F<sub>e</sub> + F<sub>e</sub> / S<sub>e</sub>)

改进后整个系统的加速比 S<sub>n</sub> = T<sub>0</sub> / T<sub>n</sub>

CPU 的时钟周期数 = ∑I<sub>i</sub> * CPI<sub>i</sub>

CPU 时间 = (∑I<sub>i</sub> * CPI<sub>i</sub>) * 时钟周期
## 性价比：桌面机，服务器

# 指令系统原理与实例
## 指令集系统结构分类及特点

![](https://s2.ax1x.com/2019/06/22/Z9sOMT.png)

`C = A + B` 在这四类系统结构中分别是如何表示和执行的

![](https://s2.ax1x.com/2019/06/22/Z9y8OS.png)
通用寄存器系统结构的分类及特点（寄存器-存储器、寄存器-寄存器）

按照寄存器访问方式划分，有三种寄存器系统结构的计算机：

- register-memory系统结构，任何一条指令都可以访问存储器。
- register-register系统结构，即load-store系统结构，只能通过load和store指令来访问内存（1980年之后设计的计算机都使用这种结构）
- memory-memory系统结构，现实中不存在的结构，把所有的数据都保存在存储器中。

![](https://s2.ax1x.com/2019/06/22/Z96NnO.png)

## 存储器寻址：基本单位、小端与大端模式、对齐访问、最常用寻址方式
小端模式把地址为“X…X000”的字节放在整个字的最低有效位置上，字节内各位编码为76543210

大端模式把地址为“X…X000”的字节放在整个字的最高有效位置上，字节内各位编码为01234567

在许多计算机上，对大于一个字节的数据的寻址必须对齐

如果数据没有对齐，它们的存取需要对存储器进行两次访问才能完成。

如果数据是对齐的，只要存储器与其大小一致，那么这个数据就可以通过一次访问存储器完成

## 常用操作数类型
字符（1B）、半字（ 2B ）、字（ 4B ）、单精度浮点数（ 4B ）、双精度浮点数（ 8B ）。定点几乎都用二进制补码表示，字符几乎都是ASCII编码格式。

## MIPS系统结构也是RISC的主要特点、MIPS的指令长度（32位）
RISC 的特点
- 大多数指令在一个周期内完成
- 运算类指令只能访问寄存器
- 采用 LOAD/SRORE 结构
- 较少的指令数和寻址方式
- 固定的指令格式
- 面向寄存器的结构
- 硬布线控制逻辑
- 注重编译的优化

现代编译器的结构

![](https://s2.ax1x.com/2019/06/22/Z92gu6.png)

MIPS：一种简单64位load-store系统结构

MIPS是一种适合于学习和研究的系统结构模型，是一种应用广泛且容易理解的系统结构。
- 简单的load-store指令系统
- 设计上重视流水线效率，包括固定长度指令编码。
- 使编译器更容易产生高效的目标代码。

MIPS的数据传输和寻址方式
- MIPS数据寻址方式只有立即数和位移量两种方式，这两种方式都是16位的。
- 寄存器间接寻址是通过把0放入16位位移字段中完成的
- 16位绝对寻址字段是通过 R0作为基址寄存器完成的。 
- MIPS的存储器是用64位地址字节寻址的。有一个供软件选择的模式位来决定是高位字节先传格式还是低位字节先传格式。
- 因为它是load-store系统结构，所有的存储器访问都必须通过存储器和通用寄存器GPR或存储器和FPR之间的载入或存储操作完成。
- 所有存储器访问必须是对齐的。

# 流水线：基础和中级概念
流水线定义

流水线的相关概念

流水线模型机指令系统、无相关流水线模型机多条指令执行过程，流水线模型机的控制信号的产生

流水线模型机中结构相关处理，数据前推、load前推实现，控制相关处理，指令执行的时序图

精确中断与非精确中断

经典5段流水线扩展浮点流水线，涉及到的写冲突、相关及处理

# 指令级并行及其开发
静态调度的循环展开方法，名相关，寄存器换名（编译器实现）

动态调度，记分牌算法（没有直接消除名相关：靠停顿延迟解决）， Tomasulo算法

动态转移预测，BPB，BTB，前瞻执行的基本概念（前瞻执行的4个阶段、ROB存放内容）

# 存储系统
Cache存储器的三种映像方式（全相联、直接映像，组相联），物理地址与Cache地址的映射计算，Cache的映像规则，块标识，替换算法，写策略

Cache性能计算：CPU执行时间，平均存储器访问时间（二级cache时，一级cache缺失代价实际上是二级cache的平均访存时间 ）

Cache性能优化的方法，减少缺失率4种，减少缺失代价5种，减少缺失率或缺失代价3种，减少命中时间5种。

虚拟存储器基本概念，页式虚拟存储器，映像规则，查找方法，替换算法，写策略，快表TLB的结构与作用

虚拟存储器与cache的综合
